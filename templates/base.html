{% load static %}
<!DOCTYPE HTML>
<html>
    <head>
        <meta charset='utf-8' />
        <title>{% block title %}{% endblock %}</title>
        <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css' rel='stylesheet' integrity='sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1' crossorigin='anonymous'>
        <link rel='stylesheet' href='{% static "stufinite/css/stufinite.css" %}'> 
        <link rel="stylesheet" href={% static "bower_components/semantic/dist/semantic.min.css" %}>
        {% block stylesheet %} {% endblock %}
    </head>
    <body>
        <header class='stufinite-header'>
            <div class="stufinite-inner">
                <div class='stufinite-header-logo'>
                    <img src='{% static "stufinite/img/logo.svg" %}' alt="LOGO">
                </div>
                <div class="nav_bar">
                    <ul class="nav_pills">
                        <li><a href="https://login.campass.com.tw/accounts/login/">課表</a></li>
                        <li><a href="/infernoWeb/sloth?school=nchu&start=1">課程心得</a></li>
                        <li><a href="">職缺專區</a></li>
                    </ul>
                </div>
                <div class='stufinite-header-search'>
                    <input id='search-form' type='text' placeholder='輸入課程名稱、教師、職缺或公司名稱進行搜尋'>
                </div>
                <input class="search-btn" type="button" value="送出"></input>
                <div class='stufinite-header-item'>
                    <a id='fb-login-btn' href="https://www.facebook.com/v2.9/dialog/oauth?client_id= 199021993947051&redirect_uri=http://test.localhost.login.campass.com.tw:8080/fb?redirect_service=www"><i class="fa fa-facebook-square" aria-hidden="true"></i> Login</a>
                </div>
            </div>
        </header>
        {% block content %} 
        {% endblock %}
        <footer>
            <span>Copyright © 2016 All rights reserved.</span>
            <a target="_blank" href="https://www.facebook.com/CoursePickingHelper/"><i class="fa fa-facebook-square" aria-hidden="true"></i></a>
        </footer>

        <script src={% static "bower_components/jquery/dist/jquery.min.js" %}></script>
        <script src={% static "bower_components/semantic/dist/semantic.min.js" %}></script>
        <script type="text/javascript">
            function getCookie(name) {
                    //name should be 'csrftoken', as an argument to be sent into getCookie()
                   var cookieValue = null;
                   if (document.cookie && document.cookie != '') {
                       var cookies = document.cookie.split(';');
                       for (var i = 0; i < cookies.length; i++) {
                           var cookie = jQuery.trim(cookies[i]);
                           // Does this cookie string begin with the name we want?
                           if (cookie.substring(0, name.length + 1) == (name + '=')) {
                               cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                               break;
                           }
                       }
                   }
                   return cookieValue;
            }
            (function main() {
              let loginUrl = "http://test.localhost.login.campass.com.tw:8080"
              $.ajax({
                url: loginUrl + '/fb/user',
                dataType: 'json',
                xhrFields: {
                  withCredentials: true
                },
                success: (res) => {
                  $('#fb-login-btn').html('<i class="fa fa-facebook-square" aria-hidden="true"></i> Logout').attr('href', loginUrl + '/fb/logout?redirect_service=www');
                  $.post('/infernoWeb/sloth/createUser', Object.assign(res, {'csrfmiddlewaretoken':getCookie('csrftoken')}))
                  .done(function(response) {
                    document.cookie = `facebookid=${res['id']}`;
                  })
                  .fail(function(response) {
                  })
                },
                error: (res) => {
                  // User is not logged in
                  console.log('not loggin')
                }
              }); 
            })();
            $(document).ready(function(){
                function search(){
                    $('#courseList').empty()
                    urlpattern = "{{urlpattern|escapejs}}"
                    school = "{{school|escapejs}}"
                    
                    keyword = $('#search-form').val();
                    qrystr = `keyword=${keyword}`
                    window.location.href = `${urlpattern}?school=${school}&${qrystr}`
                }
                $('.search-btn').click(function(){
                    search()
                })

                $("#search-form").keyup(function(event){
                    if(event.keyCode == 13 || event.which == 13){
                        search()
                    }
                });
            })
        </script>
        {% block javascript %}
        {% endblock %}
    </body>
</html>