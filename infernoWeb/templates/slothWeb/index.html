{% extends "infernoWeb/index.html" %}
{% load static %}
{% block navbar %}

	<ul class="nav">
		<li><a class="nav-link" href="/infernoWeb/sloth?school={{school}}&start=1&ctype=通識">通識</a></li>
		<li><a class="nav-link" href="/infernoWeb/sloth?school={{school}}&start=1&ctype=必修">必修</a></li>
		<li><a class="nav-link" href="/infernoWeb/sloth?school={{school}}&start=1&ctype=選修">選修</a></li>
		<li><a class="nav-link" href="/infernoWeb/sloth?school={{school}}&start=1&ctype=其他">其他</a></li>
	</ul>

{% endblock %}
{% block shopInfoBox %}

	<div id="courseList"></div>
	<div class="ui borderless menu">
	</div>

{% endblock %}
{% block javascript %}

	<script>
	$( document ).ready(function() {
		$.getJSON('/sloth/get/clist' + window.location.search, function(json){
			first = json.shift()
			length = first['TotalPage']
			school = first['school']
			ctype = first['ctype']

			let page = [...Array(length)].map((_,i) => i+1);
			for(let i of page){
				let item = $(`<a class="item">${i}</a>`)
				item.attr('href', `/infernoWeb/sloth?school=${school}&start=${i}&ctype=${ctype}`)
				$('.borderless.menu').append(item)
			}

			for(let i of json){
				let result = $(`
				  <div class="shopInfoBox">
					<div class="thumbnail">
						<a href="" class='avatar'><img class="shopImg" src=""></a>
						<div class="shopBoxBody">
							<a href="" class='title'><span class="shopTitle"></span></a>
							<span class="type" style="color:red"></span>{# 課程的類型 #}
							<div id='School_teacher'></div>
							<div id='feedback_amount'></div>
						</div>
					</div>
				  </div>
				`)
				School_teacher = $.parseHTML(`<p class="teacher">學校：${i['fields']['school']} 老師：${i['fields']['teacher']}</p>`)
				tmp = $.parseHTML('<h3><i class="fa fa-star" aria-hidden="true"></i>' + i['fields']['feedback_amount']+'人參與評分' + '</h3>')
				result
				  .find('a.avatar').attr('href', '/infernoWeb/sloth/inside?id='+i['pk']).end()
				  .find('a.title').attr('href', '/infernoWeb/sloth/inside?id='+i['pk']).end()
				  .find('img').attr('src', i['fields']['avatar']).end()
				  .find('span.shopTitle').text(i['fields']['name']).end()
				  .find('span.type').text(i['fields']['ctype']).end()
				  .find('#School_teacher').html(School_teacher).end()
				  .find('#feedback_amount').html(tmp).end()
				$('#courseList').append(result)			
			}
		})
	})
	</script>
	
{% endblock %}
{% block shopInfoBox %}
	{% for c in clist %}

		<div class="shopInfoBox">
			<div class="thumbnail">
				<a href="/infernoWeb/sloth/inside?id={{c.id}}"><img class="shopImg" src="{{c.avatar.url}}"></a>
				<div class="shopBoxBody">
					<span class="shopTitle">{{c.name}}</span> 
					<span style="color:red">{{c.ctype}}</span>{# 課程的類型 #}
					<p>學校：{{c.school}} 老師：{{c.teacher}}</p>
					<h3><i class="fa fa-star" aria-hidden="true"></i>{{c.feedback_amount}}人參與評分</h3>
				</div>
			</div>
		</div>
		
	{% endfor %}
{% endblock %}